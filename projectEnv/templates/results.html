<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qc Results</title>
    <link rel="stylesheet" href="{{url_for('static', filename='style/results.css')}}">
</head>
<body>
    <div class="banner"> 
        <a href="{{ url_for('index') }}" id="goBack">Go Back</a>
        <h1 id="title">Search Results</h1>
        </div>
        <div class="search-container">
        <div class="product-row">
            {% for d in result %}
         <div class="product">
            <div class="product-top">
                <h2 class="product-title">{{d.title}}</h2>
                <button class="toggle-button" onclick="toggleTitle(this)">...</button>
            </div>
            <p class="product-middle" id="rating">Rating: {{d.rating}}</p>
            <div class="product-bottom">
                <div class="button-container">
                    <a href="{{d.url}}" target="_blank" rel="noopener noreferrer">
                        <button class="reddit">Reddit</button>
                    </a>
                    <a href="{{d.url}}" target="_blank" rel="noopener noreferrer">
                        <button class="wtc">WTC</button>
                    </a>
                </div>
            </div>
         </div>
        
        <div>&nbsp;</div>
        {% endfor %}
    </div>
        <form action="{{ url_for('results') }}" class="button-container2"  method="post">
            <button  name="fromResults" id="load-more">Load More</button>
        </form>
   </div>
   <p id="end">End of Search Results</p>
</div>
</body>
<script>

function truncateTitle(title) {
    // Get the computed line-height of the title
    const lineHeight = parseFloat(getComputedStyle(title).lineHeight);

    // Check if the title's scrollHeight is greater than twice the line-height
    if (title.scrollHeight > lineHeight * 3) {
        // If it is, the title is exceeding two lines, so add the 'truncated' class
        title.classList.add('truncated');
    }
}

function toggleTitle(button) {
    const title = button.previousElementSibling;
    const productTop = title.parentElement;
    const product = productTop.parentElement;
    const expanded = title.classList.contains('expanded');
    const lineHeight = parseFloat(getComputedStyle(title).lineHeight);

    if (expanded) {
        truncateTitle(title);
        button.textContent = '...';
        title.classList.remove('expanded');
        productTop.classList.remove('expanded');
        button.style.paddingTop = '1px';
        button.style.paddingBottom = '9.5px';
        button.style.height = `${button.offsetHeight -8.5}px`;
        product.style.height = "auto";
        productTop.style.height = "auto";
        productTop.style.zIndex = "1";
        title.style.maxHeight = `${lineHeight * 2}px`;
        productTop.style.height = `${lineHeight * 2}px`;
    } else {
        title.style.whiteSpace = 'normal';
        title.classList.add('expanded');
        productTop.classList.add('expanded');
        button.textContent = '-';
        button.style.paddingTop = '3.5px';
        button.style.paddingBottom = '6.5px';
        button.style.height = `${button.offsetHeight -50}px`;   
        productTop.style.zIndex = "900";
        productTop.style.height = "auto"
        title.style.maxHeight = `${lineHeight * 6}px`;
        productTop.style.maxHeight = `${lineHeight * 6}px`;
    }
}

document.addEventListener("DOMContentLoaded", function () {
    const titles = document.querySelectorAll(".product-title");

    titles.forEach((title) => {
        title.setAttribute('data-full-title', title.textContent);
        truncateTitle(title);
    });
});


</script>
</html>
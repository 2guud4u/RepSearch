<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qc Results</title>
    <link rel="stylesheet" href="{{url_for('static', filename='style/results.css')}}">
</head>
<body>
    <div class="banner"> 
        <a href="{{ url_for('index') }}" id="goBack">Go Back</a>
        <h1 id="title">Search Results</h1>
        </div>
    <div class="search-container">
    <div class="product-row">
        {% for d in result %}
        <div class="product">
            <div class="product-top">
            <h2 class="product-title">{{d.title}}</h2><button class="toggle-button" onclick="toggleTitle(this)">...</button></div>
            <p class="product-middle" id="rating">Rating: {{d.rating}}</p>
            <div class="product-bottom">
            <div class="button-container">
                <a href="{{d.url}}" target="_blank" rel="noopener noreferrer">
                    <button class="reddit">Reddit</button>
                </a>
                <a href="{{d.url}}" target="_blank" rel="noopener noreferrer">
                    <button class="wtc">WTC</button>
                </a>
            </div>
            </div>
            </div>
        
        <div>&nbsp;</div>
        {% endfor %}
    </div>
   </div>
   <p id="end">End of Search Results</p>
</div>
</body>
<script>

function truncateTitle(title) {
    const lineHeight = parseFloat(getComputedStyle(title).lineHeight);
    const maxHeight = lineHeight * 2;
    const words = title.textContent.split(' ');

    title.style.whiteSpace = 'nowrap';

    for (let i = 1; i < words.length; i++) {
        const testTitle = title.textContent + ' ' + words[i];
        title.textContent = testTitle;
        if (title.offsetHeight > maxHeight) {
            title.textContent = title.textContent.substr(0, title.textContent.lastIndexOf(words[i])) + '...';
            break;
        }
    }
}

let button = document.getElementById('toggle-button');

function toggleTitle(button) {
    const title = button.previousElementSibling;
    const productTop = title.parentElement;
    const expanded = title.classList.contains('expanded');

    if (expanded) {
        truncateTitle(title);
        title.classList.remove('expanded');
        button.textContent = '...';
        button.style.paddingTop = '1px';
        button.style.paddingBottom = '9.5px';
        button.style.height = `${button.offsetHeight -8.5}px`;
        productTop.style.height = 'auto'; 

    } else {
        title.style.whiteSpace = 'normal';
        title.textContent = title.getAttribute('data-full-title');
        title.classList.add('expanded');
        button.textContent = '-';
        button.style.paddingTop = '3.5px';
        button.style.paddingBottom = '6.5px';
        button.style.height = `${button.offsetHeight -50}px`;
        productTop.style.height = productTop.scrollHeight + 'px';
    }
}

document.addEventListener("DOMContentLoaded", function () {
    const titles = document.querySelectorAll(".product-title");

    titles.forEach((title) => {
        title.setAttribute('data-full-title', title.textContent);
        truncateTitle(title);
    });
});

// const goBackLink = document.getElementById('goBack');
// goBackLink.addEventListener('click', function(event) {
//   event.preventDefault(); // prevent default behavior
//   window.location.href = 'http://127.0.0.1:8000'; // navigate to desired page
// });

</script>
</html>